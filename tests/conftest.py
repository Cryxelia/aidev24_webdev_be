from app import create_app
import pytest
import os
from dotenv import load_dotenv
from pymongo import MongoClient

load_dotenv()

@pytest.fixture
def client():
    """Create a test client using a test config."""
    app = create_app({"TESTING": True})
    return app.test_client()

def test_home_route(client):
    """Example test for a route."""
    response = client.get("/users") 
    assert response.status_code == 200


@pytest.fixture(scope="function")
def test_db():
    """Fixture to insert and clean up test data in the database."""

    connection_string = f"{os.getenv('MONGODB_URI')}"

    client = MongoClient(connection_string)

    db = client[os.getenv("MONGODB_DB_TEST")]

    db.users.insert_many(
        [
            {
                "username": "Tester",
                "password": "scrypt:32768:8:1$V0pUNEOaXZ0WGj0w$4806ade64749ea6a023bd33f5dcd9a69248b7eaf9f0d90c8e49450f9245bf4ad34acd926845490d27c0841b674dbaa479a6f998682c7241c5ca22d8597cd9d76",
            },
            {
                "username": "Jonas",
                "password": "scrypt:32768:8:1$J1LiuMGMoO5Yd8CD$a58c42f1d2c670efc33eeff75b35aa7083adad2deee36bfef8af28e670af2b1c84ac52cc7a267d7738fe3f050f16f209cbe3e28e1473c52f9df65e13ad462081",
            },
        ]
    )

    db.paths.insert_many(
        [
            {
                "waypoints": [
                    [59.37894, 17.93532],
                    [59.37891, 17.93519],
                    [59.37886, 17.935],
                    [59.37877, 17.93442],
                    [59.37876, 17.93407],
                    [59.37872, 17.93377],
                    [59.37851, 17.93321],
                    [59.37846, 17.93298],
                    [59.37845, 17.93286],
                    [59.37846, 17.93275],
                    [59.37817, 17.93286],
                    [59.37808, 17.93291],
                    [59.37798, 17.93298],
                    [59.37791, 17.93255],
                    [59.37791, 17.93249],
                    [59.37789, 17.93242],
                    [59.37782, 17.93228],
                    [59.37778, 17.93225],
                    [59.3776, 17.93228],
                    [59.37749, 17.93251],
                    [59.37743, 17.93235],
                    [59.37725, 17.93264],
                    [59.37719, 17.93278],
                    [59.3771, 17.93257],
                    [59.37691, 17.93284],
                    [59.37684, 17.93264],
                    [59.37676, 17.93275],
                    [59.37663, 17.93232],
                    [59.37657, 17.93196],
                    [59.37642, 17.93129],
                    [59.37628, 17.9309],
                    [59.37626, 17.93085],
                    [59.37625, 17.93074],
                    [59.37598, 17.92979],
                    [59.37595, 17.92973],
                    [59.37586, 17.92988],
                    [59.3758, 17.92976],
                    [59.37577, 17.92967],
                    [59.37576, 17.92949],
                    [59.37573, 17.92936],
                    [59.37569, 17.92925],
                    [59.37563, 17.92918],
                    [59.37539, 17.92903],
                    [59.37529, 17.92894],
                    [59.37515, 17.92868],
                    [59.375, 17.92849],
                    [59.3748, 17.92837],
                    [59.37457, 17.92837],
                    [59.37446, 17.92809],
                    [59.37443, 17.92807],
                    [59.37439, 17.92787],
                    [59.37422, 17.92707],
                    [59.37419, 17.92701],
                    [59.37413, 17.92701],
                    [59.37409, 17.92709],
                    [59.37409, 17.92721],
                    [59.37414, 17.92728],
                    [59.37417, 17.92726],
                    [59.37422, 17.92718],
                    [59.37425, 17.92705],
                    [59.37423, 17.92682],
                    [59.37413, 17.92649],
                    [59.37458, 17.92593],
                    [59.37467, 17.92577],
                    [59.37503, 17.92478],
                    [59.37506, 17.92466],
                    [59.37514, 17.92489],
                    [59.37561, 17.92543],
                    [59.37573, 17.9255],
                    [59.37592, 17.92555],
                    [59.37596, 17.92553],
                    [59.37618, 17.92599],
                    [59.37751, 17.92622],
                    [59.37797, 17.92646],
                    [59.37829, 17.92663],
                    [59.37836, 17.92668],
                    [59.37847, 17.92688],
                    [59.37865, 17.92709],
                    [59.37882, 17.92751],
                    [59.37893, 17.92766],
                    [59.3793, 17.92852],
                    [59.37941, 17.92865],
                    [59.37991, 17.92955],
                    [59.38018, 17.92972],
                    [59.38029, 17.92989],
                    [59.38028, 17.92995],
                    [59.38026, 17.93019],
                    [59.38019, 17.93049],
                    [59.38021, 17.93063],
                    [59.38031, 17.93095],
                    [59.38035, 17.93126],
                    [59.38037, 17.93156],
                    [59.38035, 17.93181],
                    [59.38035, 17.93197],
                    [59.38038, 17.93212],
                    [59.38047, 17.93232],
                    [59.38059, 17.9327],
                    [59.38063, 17.93275],
                    [59.38083, 17.93274],
                    [59.38116, 17.93305],
                    [59.38111, 17.93329],
                    [59.38118, 17.934],
                    [59.38138, 17.9341],
                    [59.38152, 17.93429],
                    [59.38156, 17.93434],
                    [59.38165, 17.93442],
                    [59.38175, 17.93447],
                    [59.38199, 17.93443],
                    [59.38218, 17.93435],
                    [59.38235, 17.93414],
                    [59.38239, 17.93405],
                    [59.38275, 17.93302],
                    [59.38282, 17.93285],
                    [59.38291, 17.93274],
                    [59.38298, 17.93272],
                    [59.38303, 17.93273],
                    [59.38311, 17.93278],
                    [59.38313, 17.93268],
                    [59.38334, 17.9328],
                    [59.38339, 17.93277],
                    [59.38344, 17.93266],
                    [59.38349, 17.93275],
                    [59.38355, 17.93282],
                    [59.38359, 17.9329],
                    [59.38357, 17.93338],
                    [59.38355, 17.93342],
                    [59.38382, 17.9343],
                    [59.38391, 17.93455],
                    [59.38388, 17.93461],
                    [59.38384, 17.93468],
                    [59.38375, 17.93482],
                    [59.38373, 17.93496],
                    [59.38387, 17.93506],
                    [59.38393, 17.9352],
                    [59.38394, 17.93538],
                    [59.38392, 17.93551],
                    [59.38364, 17.93665],
                    [59.38333, 17.93791],
                    [59.38326, 17.93807],
                    [59.38349, 17.9382],
                    [59.38356, 17.93818],
                    [59.38377, 17.93794],
                    [59.38383, 17.93789],
                    [59.38391, 17.93787],
                    [59.38399, 17.93791],
                    [59.38406, 17.93799],
                    [59.38427, 17.93827],
                    [59.38369, 17.94009],
                    [59.38354, 17.94033],
                    [59.38352, 17.94039],
                    [59.38309, 17.9416],
                    [59.38271, 17.94272],
                    [59.38248, 17.94347],
                    [59.38255, 17.94361],
                    [59.38209, 17.94519],
                    [59.38197, 17.94517],
                    [59.38193, 17.94535],
                    [59.38175, 17.9453],
                    [59.38167, 17.94529],
                    [59.38155, 17.94534],
                    [59.38145, 17.94547],
                    [59.38141, 17.94537],
                    [59.38134, 17.94531],
                    [59.38116, 17.94521],
                    [59.38096, 17.94506],
                    [59.38088, 17.94493],
                    [59.38083, 17.94478],
                    [59.38081, 17.94449],
                    [59.38096, 17.94301],
                    [59.381, 17.94224],
                    [59.3813, 17.94051],
                    [59.38129, 17.94044],
                    [59.38125, 17.94032],
                    [59.38117, 17.94023],
                    [59.38108, 17.94002],
                    [59.38098, 17.93969],
                    [59.38091, 17.93974],
                    [59.38087, 17.93953],
                    [59.38053, 17.93973],
                    [59.38031, 17.93998],
                    [59.38023, 17.94009],
                    [59.38014, 17.94045],
                    [59.38008, 17.93967],
                    [59.38012, 17.93954],
                    [59.38005, 17.93934],
                    [59.37981, 17.93956],
                    [59.37941, 17.93988],
                    [59.37925, 17.94015],
                    [59.37913, 17.93984],
                    [59.37899, 17.93961],
                    [59.3789, 17.93953],
                    [59.37888, 17.93939],
                    [59.37892, 17.93926],
                    [59.37906, 17.93916],
                    [59.37914, 17.93914],
                    [59.37922, 17.93903],
                    [59.37922, 17.93879],
                    [59.37925, 17.93851],
                    [59.3794, 17.93827],
                    [59.37936, 17.93785],
                    [59.37922, 17.93789],
                    [59.37905, 17.93793],
                    [59.37891, 17.93797],
                    [59.37881, 17.93757],
                    [59.37886, 17.9373],
                    [59.37889, 17.93651],
                    [59.37894, 17.93635],
                    [59.37897, 17.93624],
                    [59.37898, 17.93611],
                    [59.37901, 17.9358],
                    [59.37899, 17.93552],
                    [59.37896, 17.93539],
                    [59.37894, 17.93532],
                ],
                "title": "Fake run",
                "distance": 1000,
                "time": 0,
                "user_id": "67eab12744ebf2ba016da94a",
            },
            {
                "waypoints": [
                    [59.37894, 17.93532],
                    [59.37891, 17.93519],
                    [59.37886, 17.935],
                    [59.37877, 17.93442],
                    [59.37876, 17.93407],
                    [59.37872, 17.93377],
                    [59.37851, 17.93321],
                    [59.37846, 17.93298],
                    [59.37845, 17.93286],
                    [59.37846, 17.93275],
                    [59.37817, 17.93286],
                    [59.37808, 17.93291],
                    [59.37798, 17.93298],
                    [59.37791, 17.93255],
                    [59.37791, 17.93249],
                    [59.37789, 17.93242],
                    [59.37782, 17.93228],
                    [59.37778, 17.93225],
                    [59.3776, 17.93228],
                    [59.37749, 17.93251],
                    [59.37743, 17.93235],
                    [59.37725, 17.93264],
                    [59.37719, 17.93278],
                    [59.3771, 17.93257],
                    [59.37691, 17.93284],
                    [59.37684, 17.93264],
                    [59.37676, 17.93275],
                    [59.37663, 17.93232],
                    [59.37657, 17.93196],
                    [59.37642, 17.93129],
                    [59.37628, 17.9309],
                    [59.37626, 17.93085],
                    [59.37625, 17.93074],
                    [59.37598, 17.92979],
                    [59.37595, 17.92973],
                    [59.37586, 17.92988],
                    [59.3758, 17.92976],
                    [59.37577, 17.92967],
                    [59.37576, 17.92949],
                    [59.37573, 17.92936],
                    [59.37569, 17.92925],
                    [59.37563, 17.92918],
                    [59.37539, 17.92903],
                    [59.37529, 17.92894],
                    [59.37515, 17.92868],
                    [59.375, 17.92849],
                    [59.3748, 17.92837],
                    [59.37457, 17.92837],
                    [59.37446, 17.92809],
                    [59.37443, 17.92807],
                    [59.37439, 17.92787],
                    [59.37422, 17.92707],
                    [59.37419, 17.92701],
                    [59.37413, 17.92701],
                    [59.37409, 17.92709],
                    [59.37409, 17.92721],
                    [59.37414, 17.92728],
                    [59.37417, 17.92726],
                    [59.37422, 17.92718],
                    [59.37425, 17.92705],
                    [59.37423, 17.92682],
                    [59.37413, 17.92649],
                    [59.37458, 17.92593],
                    [59.37467, 17.92577],
                    [59.37503, 17.92478],
                    [59.37506, 17.92466],
                    [59.37514, 17.92489],
                    [59.37561, 17.92543],
                    [59.37573, 17.9255],
                    [59.37592, 17.92555],
                    [59.37596, 17.92553],
                    [59.37618, 17.92599],
                    [59.37751, 17.92622],
                    [59.37797, 17.92646],
                    [59.37829, 17.92663],
                    [59.37836, 17.92668],
                    [59.37847, 17.92688],
                    [59.37865, 17.92709],
                    [59.37882, 17.92751],
                    [59.37893, 17.92766],
                    [59.3793, 17.92852],
                    [59.37941, 17.92865],
                    [59.37991, 17.92955],
                    [59.38018, 17.92972],
                    [59.38029, 17.92989],
                    [59.38028, 17.92995],
                    [59.38026, 17.93019],
                    [59.38019, 17.93049],
                    [59.38021, 17.93063],
                    [59.38031, 17.93095],
                    [59.38035, 17.93126],
                    [59.38037, 17.93156],
                    [59.38035, 17.93181],
                    [59.38035, 17.93197],
                    [59.38038, 17.93212],
                    [59.38047, 17.93232],
                    [59.38059, 17.9327],
                    [59.38063, 17.93275],
                    [59.38083, 17.93274],
                    [59.38116, 17.93305],
                    [59.38111, 17.93329],
                    [59.38118, 17.934],
                    [59.38138, 17.9341],
                    [59.38152, 17.93429],
                    [59.38156, 17.93434],
                    [59.38165, 17.93442],
                    [59.38175, 17.93447],
                    [59.38199, 17.93443],
                    [59.38218, 17.93435],
                    [59.38235, 17.93414],
                    [59.38239, 17.93405],
                    [59.38275, 17.93302],
                    [59.38282, 17.93285],
                    [59.38291, 17.93274],
                    [59.38298, 17.93272],
                    [59.38303, 17.93273],
                    [59.38311, 17.93278],
                    [59.38313, 17.93268],
                    [59.38334, 17.9328],
                    [59.38339, 17.93277],
                    [59.38344, 17.93266],
                    [59.38349, 17.93275],
                    [59.38355, 17.93282],
                    [59.38359, 17.9329],
                    [59.38357, 17.93338],
                    [59.38355, 17.93342],
                    [59.38382, 17.9343],
                    [59.38391, 17.93455],
                    [59.38388, 17.93461],
                    [59.38384, 17.93468],
                    [59.38375, 17.93482],
                    [59.38373, 17.93496],
                    [59.38387, 17.93506],
                    [59.38393, 17.9352],
                    [59.38394, 17.93538],
                    [59.38392, 17.93551],
                    [59.38364, 17.93665],
                    [59.38333, 17.93791],
                    [59.38326, 17.93807],
                    [59.38349, 17.9382],
                    [59.38356, 17.93818],
                    [59.38377, 17.93794],
                    [59.38383, 17.93789],
                    [59.38391, 17.93787],
                    [59.38399, 17.93791],
                    [59.38406, 17.93799],
                    [59.38427, 17.93827],
                    [59.38369, 17.94009],
                    [59.38354, 17.94033],
                    [59.38352, 17.94039],
                    [59.38309, 17.9416],
                    [59.38271, 17.94272],
                    [59.38248, 17.94347],
                    [59.38255, 17.94361],
                    [59.38209, 17.94519],
                    [59.38197, 17.94517],
                    [59.38193, 17.94535],
                    [59.38175, 17.9453],
                    [59.38167, 17.94529],
                    [59.38155, 17.94534],
                    [59.38145, 17.94547],
                    [59.38141, 17.94537],
                    [59.38134, 17.94531],
                    [59.38116, 17.94521],
                    [59.38096, 17.94506],
                    [59.38088, 17.94493],
                    [59.38083, 17.94478],
                    [59.38081, 17.94449],
                    [59.38096, 17.94301],
                    [59.381, 17.94224],
                    [59.3813, 17.94051],
                    [59.38129, 17.94044],
                    [59.38125, 17.94032],
                    [59.38117, 17.94023],
                    [59.38108, 17.94002],
                    [59.38098, 17.93969],
                    [59.38091, 17.93974],
                    [59.38087, 17.93953],
                    [59.38053, 17.93973],
                    [59.38031, 17.93998],
                    [59.38023, 17.94009],
                    [59.38014, 17.94045],
                    [59.38008, 17.93967],
                    [59.38012, 17.93954],
                    [59.38005, 17.93934],
                    [59.37981, 17.93956],
                    [59.37941, 17.93988],
                    [59.37925, 17.94015],
                    [59.37913, 17.93984],
                    [59.37899, 17.93961],
                    [59.3789, 17.93953],
                    [59.37888, 17.93939],
                    [59.37892, 17.93926],
                    [59.37906, 17.93916],
                    [59.37914, 17.93914],
                    [59.37922, 17.93903],
                    [59.37922, 17.93879],
                    [59.37925, 17.93851],
                    [59.3794, 17.93827],
                    [59.37936, 17.93785],
                    [59.37922, 17.93789],
                    [59.37905, 17.93793],
                    [59.37891, 17.93797],
                    [59.37881, 17.93757],
                    [59.37886, 17.9373],
                    [59.37889, 17.93651],
                    [59.37894, 17.93635],
                    [59.37897, 17.93624],
                    [59.37898, 17.93611],
                    [59.37901, 17.9358],
                    [59.37899, 17.93552],
                    [59.37896, 17.93539],
                    [59.37894, 17.93532],
                ],
                "title": "Real run",
                "distance": 1000,
                "time": 0,
                "user_id": "67ec32aca1286cc26056bfee",
            },
        ]
    )

    yield db

    db.users.delete_many({})
    db.paths.delete_many({})
